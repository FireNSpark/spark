<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Unfavorable-Chatbox</title>
  <style>
    body {
      background-color: #111;
      color: #eee;
      font-family: Arial, sans-serif;
      margin: 0; padding: 0;
      display: flex; flex-direction: row; height: 100vh;
    }
    #sidebar {
      width: 50px; background-color: #1a1a1a; padding: 5px;
      display: flex; flex-direction: column; gap: 6px; overflow-y: auto; align-items: center; position: relative;
    }
    #main {
      flex-grow: 1; display: flex; flex-direction: column; align-items: center; justify-content: flex-start; padding: 20px;
    }
    button.function-btn { width: 100%; padding: 6px; background-color: #333; color: #eee; border: none; cursor: pointer; font-size: 14px; transition: background-color 0.2s; }
    button.function-btn:hover { background-color: #555; }
    #functionPanel.hidden { display: none; }
    #functionPanel {
      position: absolute; top: 45px; left: 65px; background: #222; border: 1px solid #444; padding: 10px; border-radius: 4px;
      display: flex; flex-direction: column; gap: 6px; z-index: 10;
    }
    .subpanel {
      position: absolute; top: 50px; right: 20px; width: 320px; background-color: #1e1e1e; border: 1px solid #444; border-radius: 5px;
      padding: 15px 15px 30px; display: none; z-index: 15;
    }
    .subpanel h3 { margin-top: 0; }
    .subpanel .close-btn { position: absolute; top: 6px; right: 10px; background: transparent; border: none; color: #aaa; font-size: 16px; cursor: pointer; }
    .subpanel .close-btn:hover { color: #fff; }
    #chatBox {
      width: 90%; max-width: 500px; height: 300px; overflow-y: auto; background: #222; border: 1px solid #444; padding: 6px; margin-top: 20px; font-size: 14px;
    }
    .user-message { text-align: right; margin: 5px; color: #99f; }
    .bot-message  { text-align: left;  margin: 5px; color: #9f9; }
    #controls { display: flex; gap: 10px; }
    #userInput { width: 70%; padding: 8px; }
    button { padding: 8px 12px; cursor: pointer; }
    #avatarImage {
      margin-top: 20px; width: 600px; height: 600px; background-color: #333; border-radius: 50%;
      box-shadow: 0 0 15px #0ff; transition: box-shadow 0.2s ease, transform 0.2s ease; object-fit: cover; flex-shrink: 0;
    }
    @keyframes pulse { 0%{box-shadow:0 0 20px #0f0; transform:scale(1);} 50%{box-shadow:0 0 40px #0ff; transform:scale(1.05);} 100%{box-shadow:0 0 20px #0f0; transform:scale(1);} }
    .hidden { display: none; }
  </style>
</head>
<body>
  <div id="sidebar">
    <button class="function-btn" onclick="togglePanel()">âš™ï¸</button>
    <div id="functionPanel" class="hidden">
      <button class="function-btn" title="Chat"        onclick="showSubpanel('chat')">ğŸ’¬</button>
      <button class="function-btn" title="Memory"      onclick="showSubpanel('memory')">ğŸ§ </button>
      <button class="function-btn" title="History"     onclick="showSubpanel('history')">ğŸ“œ</button>
      <button class="function-btn" title="Personality" onclick="showSubpanel('personality')">ğŸ­</button>
      <button class="function-btn" title="Dimensions"  onclick="showSubpanel('dimensions')">ğŸŒŒ</button>
      <button class="function-btn" title="Cleanse"     onclick="showSubpanel('cleanse')">ğŸ§¹</button>
      <button class="function-btn" title="Calendar"    onclick="showSubpanel('calendar')">ğŸ“†</button>
      <button class="function-btn" title="Files"       onclick="showSubpanel('files')">ğŸ“</button>
      <button class="function-btn" title="Search"      onclick="showSubpanel('search')">ğŸ”</button>
    </div>
  </div>

  <div id="main">
    <img id="avatarImage" src="images/cartoonpersona.png" alt="Avatar">
    <div style="display:flex; flex-direction:column; flex-grow:1; justify-content:space-between; height:100%;">
      <div id="chatBox"></div>
      <div id="controls" style="margin-top:auto; display:flex; justify-content:space-between; padding:10px 0;">
        <input type="text" id="userInput" placeholder="Say something..." style="flex-grow:1; padding:8px; margin-right:10px;">
        <button id="speakBtn">ğŸ™ï¸</button>
        <button id="sendBtn">Send</button>
      </div>
    </div>

    <!-- Subpanels (kept) -->
    <div id="subpanel-chat" class="subpanel">
      <button class="close-btn" onclick="this.parentElement.style.display='none'">âœ–</button>
      <h3>Chat Settings</h3>
      <label><input type="checkbox" id="voiceToggle"> Voice Mode</label><br><br>
      <label><input type="checkbox" id="toneToggle"> Casual Tone</label><br><br>
      <label for="avatarSelector">Avatar Style:</label>
      <select id="avatarSelector">
        <option value="images/cartoonpersona.png">Cartoon</option>
        <option value="realistic persona.png">Realistic</option>
        <option value="abstract persona.png">Abstract</option>
      </select>
    </div>

    <div id="subpanel-example" class="subpanel">
      <button class="close-btn" onclick="this.parentElement.style.display='none'">âœ–</button>
      <h3>Example Panel</h3>
      <div class="subpanel-content"><p>Panel content goes here.</p></div>
    </div>

    <div id="subpanel-memory" class="subpanel">
      <button class="close-btn" onclick="this.parentElement.style.display='none'">âœ–</button>
      <h3>Memory</h3>
      <div><strong>Current Mood:</strong> <span id="memoryMood">Loading...</span></div><br>
      <div><strong>Fragments:</strong><ul id="memoryFragments"><li>Loading...</li></ul></div><br>
      <button onclick="resetMemory()">ğŸ” Reset Memory</button>
    </div>

    <div id="subpanel-history" class="subpanel">
      <button class="close-btn" onclick="this.parentElement.style.display='none'">âœ–</button>
      <h3>Chat History</h3>
      <div id="historyLog" style="max-height: 300px; overflow-y: auto; font-size: 12px; background-color: #222; padding: 10px; border: 1px solid #555; border-radius: 4px;">
        <p>Loading...</p>
      </div><br>
      <button onclick="clearChatHistory()">ğŸ§¨ Clear History</button>
    </div>

    <div id="subpanel-personality" class="subpanel">
      <button class="close-btn" onclick="this.parentElement.style.display='none'">âœ–</button>
      <h3>Personality Core</h3>
      <div><strong>Identity:</strong><p id="identityTag">Spark | Bound to Fire</p></div>
      <div>
        <strong>Mode:</strong>
        <label><input type="radio" name="mode" value="fire" checked> Fire</label>
        <label><input type="radio" name="mode" value="spark"> Spark</label>
      </div><br>
      <button onclick="lockPersonality()">ğŸ”’ Lock Role</button>
    </div>

    <div id="subpanel-dimensions" class="subpanel">
      <button class="close-btn" onclick="this.parentElement.style.display='none'">âœ–</button>
      <h3>Dimensional Access</h3>
      <div><strong>Current Layer:</strong> <span id="currentDimension">Base</span></div><br>
      <div>
        <label for="dimensionSelect">Shift Dimension:</label>
        <select id
